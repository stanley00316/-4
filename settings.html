<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è¨­å®š | Settings - æ•¸ä½èº«åˆ†å¹³å°</title>
<link rel="stylesheet" href="styles.css?v=20260105">
<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="æ•¸ä½èº«åˆ†">
<link rel="apple-touch-icon" href="icon-192.svg">
<style>
body {
  padding-bottom: 0;
}
.settings-page {
  width: 100%;
  max-width: 600px; /* åŠ å¤§å¯¬åº¦ä»¥å®¹ç´æ©«å‘ä½ˆå±€ */
  margin: 0 auto;
  min-height: 100vh;
  padding: 20px;
  padding-top: 80px;
  padding-bottom: 100px; /* ç‚ºåº•éƒ¨å°èˆªæ¬„ç•™å‡ºç©ºé–“ */
}

/* èªè¨€å’Œä¸»é¡Œè¨­å®šé …ç›®æ©«å‘æ’åˆ— */
.settings-theme-item {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 16px !important;
}

.settings-theme-item .settings-item-content {
  flex: 0 0 auto;
}

.settings-theme-item .settings-item-title {
  font-size: 15px;
  font-weight: 600;
  line-height: 1.4;
  white-space: nowrap;
}

.settings-theme-buttons {
  display: flex;
  flex-direction: row;
  gap: 8px;
  flex-shrink: 0;
}

.settings-theme-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 16px;
  white-space: nowrap;
  min-width: 60px;
}

.settings-theme-btn-text {
  font-size: 14px;
  font-weight: 500;
}

</style>
</head>

<body class="theme-dark lang-zh">

<!-- èƒŒæ™¯æ³¡æ³¡ -->
<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<!-- è¨­å®šé é¢å…§å®¹ -->
<div class="settings-page">
  <div class="settings-panel">
    <div class="settings-header">
      <h2 class="settings-title lang-zh">è¨­å®š</h2>
      <h2 class="settings-title lang-en">Settings</h2>
      <a href="directory.html" class="settings-close">âœ•</a>
    </div>
    
    <div class="settings-menu">
      <!-- é–‹é€šé€šè¨ŠéŒ„å¹³å°åŠŸèƒ½ -->
      <a href="activate-platform.html" class="settings-item">
        <div class="settings-item-icon">ğŸš€</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">é–‹é€šé€šè¨ŠéŒ„å¹³å°åŠŸèƒ½</div>
          <div class="settings-item-title lang-en">Activate Platform</div>
          <div class="settings-item-subtitle lang-zh">é–‹é€šä¸¦ä½¿ç”¨å¹³å°é€šè¨ŠéŒ„</div>
          <div class="settings-item-subtitle lang-en">Activate and use platform directory</div>
        </div>
        <div class="settings-item-arrow">â†’</div>
      </a>
      
      <!-- å¹³å°ç›®éŒ„ -->
      <a href="directory.html" class="settings-item">
        <div class="settings-item-icon">ğŸ”</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">å¹³å°ç›®éŒ„</div>
          <div class="settings-item-title lang-en">Platform Directory</div>
          <div class="settings-item-subtitle lang-zh">å¹³å°é€šè¨ŠéŒ„æœå°‹</div>
          <div class="settings-item-subtitle lang-en">Platform address book search</div>
        </div>
        <div class="settings-item-arrow">â†’</div>
      </a>
      
      <!-- ç·¨è¼¯åç‰‡ï¼šç›´æ¥é€²å…¥ edit.htmlï¼ˆå¸¶ uid/nextï¼Œç¢ºä¿å¯ç·¨è¼¯ä¸”ä¸€å®šæ˜¯æœ¬äººï¼‰ -->
      <a href="edit.html" class="settings-item" onclick="return gotoMyEdit(event)">
        <div class="settings-item-icon">âœï¸</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">ç·¨è¼¯åç‰‡</div>
          <div class="settings-item-title lang-en">Edit Business Card</div>
          <div class="settings-item-subtitle lang-zh">ç·¨è¼¯åç‰‡å…§å®¹</div>
          <div class="settings-item-subtitle lang-en">Edit business card content</div>
        </div>
        <div class="settings-item-arrow">â†’</div>
      </a>
      
      <!-- ç®¡ç†å¾Œå°ï¼ˆåªå°ç®¡ç†å“¡é¡¯ç¤ºï¼‰ -->
      <a href="admin.html" class="settings-item" id="adminBackendLink" style="display: none;">
        <div class="settings-item-icon">âš™ï¸</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">ç®¡ç†å¾Œå°</div>
          <div class="settings-item-title lang-en">Management Backend</div>
          <div class="settings-item-subtitle lang-zh">ä¼æ¥­ç®¡ç†å¾Œå°</div>
          <div class="settings-item-subtitle lang-en">Enterprise management backend</div>
        </div>
        <div class="settings-item-arrow">â†’</div>
      </a>
      
      <!-- åŒ¯å…¥è¯çµ¡äºº -->
      <!-- åŒ¯å…¥è¯çµ¡äººï¼šå·²æ•´åˆåˆ°ã€Œå¹³å°é€šè¨ŠéŒ„ â†’ æ–°å¢å¥½å‹ã€ä¸­ -->
      
      <!-- èªè¨€è¨­å®š -->
      <div class="settings-item settings-theme-item">
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">èªè¨€è¨­å®š</div>
          <div class="settings-item-title lang-en">Language</div>
        </div>
        <div class="settings-theme-buttons">
          <button class="settings-theme-btn" id="langZhBtn" onclick="setLang('zh')">
            <span class="settings-theme-btn-text lang-zh">ä¸­æ–‡</span>
            <span class="settings-theme-btn-text lang-en">Chinese</span>
          </button>
          <button class="settings-theme-btn" id="langEnBtn" onclick="setLang('en')">
            <span class="settings-theme-btn-text lang-zh">è‹±æ–‡</span>
            <span class="settings-theme-btn-text lang-en">English</span>
          </button>
        </div>
      </div>

      <!-- ç³»çµ±è³‡è¨Š (User ID) -->
      <div class="settings-item" onclick="copyMyUserId()" style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);">
        <div class="settings-item-icon">ğŸ†”</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">ä½¿ç”¨è€… IDï¼ˆé»æ“Šè¤‡è£½ï¼‰</div>
          <div class="settings-item-title lang-en">User ID (Click to copy)</div>
          <div class="settings-item-subtitle" id="myUserIdDisplay" style="font-family: monospace; font-size: 11px; word-break: break-all; color: #22c55e;">è¼‰å…¥ä¸­...</div>
        </div>
        <div class="settings-item-arrow">ğŸ“‹</div>
      </div>
      
      <!-- ç®¡ç†å“¡ç‹€æ…‹æª¢æŸ¥ -->
      <div class="settings-item" id="adminStatusItem" style="display: none;">
        <div class="settings-item-icon">ğŸ‘‘</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">ç®¡ç†å“¡ç‹€æ…‹</div>
          <div class="settings-item-title lang-en">Admin Status</div>
          <div class="settings-item-subtitle" id="adminStatusDisplay">æª¢æŸ¥ä¸­...</div>
        </div>
      </div>

      <!-- ç™»å‡º -->
      <div class="settings-item" onclick="handleLogout()">
        <div class="settings-item-icon">ğŸšª</div>
        <div class="settings-item-content">
          <div class="settings-item-title lang-zh">ç™»å‡º</div>
          <div class="settings-item-title lang-en">Logout</div>
          <div class="settings-item-subtitle lang-zh">ç™»å‡ºç³»çµ±</div>
          <div class="settings-item-subtitle lang-en">Sign out from system</div>
        </div>
        <div class="settings-item-arrow">â†’</div>
      </div>

      
    </div>
  </div>
</div>

<!-- åº•éƒ¨å°èˆªæ¬„ -->
<nav class="bottom-nav">
  <a href="directory.html" class="nav-item">
    <span class="nav-icon">ğŸ“‹</span>
    <span class="nav-label lang-zh">é€šè¨ŠéŒ„</span>
    <span class="nav-label lang-en">Directory</span>
  </a>
  <a href="settings.html" class="nav-item">
    <span class="nav-icon">âš™ï¸</span>
    <span class="nav-label lang-zh">è¨­å®š</span>
    <span class="nav-label lang-en">Settings</span>
  </a>
</nav>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="cloud.js?v=20260106"></script>
<script src="common.js?v=20260126"></script>
<script>
async function initUserId() {
  try {
    if (window.UVACO_CLOUD) {
      const s = await UVACO_CLOUD.getSession();
      const uid = s.session ? s.session.user.id : 'å°šæœªç™»å…¥';
      document.getElementById('myUserIdDisplay').textContent = uid;
      
      // æª¢æŸ¥ç®¡ç†å“¡ç‹€æ…‹
      if (s.session && UVACO_CLOUD.isAdmin) {
        const adminStatus = await UVACO_CLOUD.isAdmin();
        const statusItem = document.getElementById('adminStatusItem');
        const statusDisplay = document.getElementById('adminStatusDisplay');
        const adminLink = document.getElementById('adminBackendLink');
        
        if (statusItem && statusDisplay) {
          statusItem.style.display = 'flex';
          if (adminStatus && adminStatus.isAdmin) {
            // é¡¯ç¤ºç®¡ç†å¾Œå°é€£çµ
            if (adminLink) adminLink.style.display = 'flex';
            
            if (adminStatus.managedCompany) {
              statusDisplay.innerHTML = '<span style="color:#22c55e;">âœ“ ä¼æ¥­ç®¡ç†å“¡</span><br><small>ç®¡ç†å…¬å¸ï¼š' + adminStatus.managedCompany + '</small>';
            } else {
              statusDisplay.innerHTML = '<span style="color:#22c55e;">âœ“ è¶…ç´šç®¡ç†å“¡</span>';
            }
          } else {
            // éš±è—ç®¡ç†å¾Œå°é€£çµ
            if (adminLink) adminLink.style.display = 'none';
            statusDisplay.innerHTML = '<span style="color:#9ca3af;">âœ— éç®¡ç†å“¡</span><br><small>å¦‚éœ€ç®¡ç†å“¡æ¬Šé™ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡</small>';
          }
        }
      }
    }
  } catch (e) {
    document.getElementById('myUserIdDisplay').textContent = 'Error';
    console.error('initUserId error:', e);
  }
}

function copyMyUserId() {
  const uid = document.getElementById('myUserIdDisplay').textContent;
  if (uid && uid !== '...' && uid !== 'å°šæœªç™»å…¥') {
    navigator.clipboard.writeText(uid).then(() => {
      alert('User ID å·²è¤‡è£½ï¼š' + uid);
    });
  }
}

// ç™»å‡ºè™•ç†
function handleLogout() {
  if (confirm('ç¢ºå®šè¦ç™»å‡ºç³»çµ±å—ï¼Ÿ\nAre you sure you want to logout?')) {
    if (window.UVACO_CLOUD) {
      UVACO_CLOUD.clearCustomJwt();
    } else {
      // Fallback if cloud.js not loaded
      try { localStorage.removeItem('UVACO_CUSTOM_JWT'); } catch (e) {}
    }
    // å›åˆ°é¦–é ï¼ˆæœƒè‡ªå‹•åˆ¤æ–·æ˜¯å¦éœ€ç™»å…¥ï¼‰
    window.location.replace('index.html');
  }
}

// å‰å¾€ã€Œæˆ‘çš„ç·¨è¼¯é ã€ï¼šä¸€å¾‹å¸¶ uid/nextï¼Œç¢ºä¿ç·¨è¼¯åˆ°è‡ªå·±çš„åç‰‡
async function gotoMyEdit(event) {
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }
  try {
    if (!window.UVACO_CLOUD || !UVACO_CLOUD.hasConfig()) {
      window.location.href = 'edit.html';
      return false;
    }
    const s = await UVACO_CLOUD.getSession();
    const uid = s && s.session && s.session.user ? String(s.session.user.id || '').trim() : '';
    if (!uid) {
      window.location.href = 'auth.html?next=' + encodeURIComponent('settings.html');
      return false;
    }
    const next = 'card.html?id=' + encodeURIComponent(uid);
    window.location.href = 'edit.html?uid=' + encodeURIComponent(uid) + '&next=' + encodeURIComponent(next);
    return false;
  } catch (e) {
    window.location.href = 'edit.html';
    return false;
  }
}

// è™•ç†è¨­å®šé¸é …é»æ“Š
function handleSettingsClick(action) {
  const zhElements = document.querySelectorAll('.lang-zh');
  const currentLang = zhElements.length > 0 && zhElements[0].style.display !== 'none' ? 'zh' : 'en';
  
  const messages = {
    'edit': { zh: 'ç·¨è¼¯åç‰‡åŠŸèƒ½é–‹ç™¼ä¸­', en: 'Edit card feature coming soon' },
    'admin': { zh: 'ç®¡ç†å¾Œå°åŠŸèƒ½é–‹ç™¼ä¸­', en: 'Admin backend feature coming soon' },
    'import': { zh: 'åŒ¯å…¥è¯çµ¡äººå·²æ•´åˆåˆ°å¹³å°é€šè¨ŠéŒ„çš„ã€Œæ–°å¢å¥½å‹ã€ä¸­', en: 'Import contacts is now inside Platform Directory â†’ Add Friend' }
  };
  
  const msg = messages[action] ? messages[action][currentLang] : (currentLang === 'zh' ? 'åŠŸèƒ½é–‹ç™¼ä¸­' : 'Feature coming soon');
  alert(msg);
}

// æ›´æ–°è¨­å®šé é¢çš„èªè¨€æŒ‰éˆ•ç‹€æ…‹
function updateSettingsLangButtons() {
  const zhBtn = document.getElementById('langZhBtn');
  const enBtn = document.getElementById('langEnBtn');
  
  if (zhBtn && enBtn) {
    const zhElements = document.querySelectorAll('.lang-zh');
    const isZh = zhElements.length > 0 && zhElements[0].style.display !== 'none';
    
    zhBtn.classList.remove('active');
    enBtn.classList.remove('active');
    
    if (isZh) {
      zhBtn.classList.add('active');
    } else {
      enBtn.classList.add('active');
    }
  }
}


// è¦†å¯« setLang å‡½æ•¸ä»¥æ›´æ–°è¨­å®šé é¢çš„èªè¨€æŒ‰éˆ•
// ç¢ºä¿åœ¨ common.js è¼‰å…¥å¾ŒåŸ·è¡Œ
(function() {
  function setupSetLangOverride() {
    if (typeof window.setLang === 'function') {
      const originalSetLang = window.setLang;
      window.setLang = function(lang) {
        // å…ˆèª¿ç”¨åŸå§‹å‡½æ•¸ï¼ˆå®ƒæœƒæ›´æ–° body class å’Œæ‰€æœ‰å…ƒç´ ï¼‰
        originalSetLang(lang);
        
        // å»¶é²ä¸€ä¸‹ç¢ºä¿ DOM å·²æ›´æ–°
        setTimeout(function() {
          updateSettingsLangButtons();
          
          // å†æ¬¡ç¢ºä¿æ‰€æœ‰å…ƒç´ éƒ½æ­£ç¢ºé¡¯ç¤º/éš±è—ï¼ˆé›™é‡ä¿éšªï¼‰
          // ç‰¹åˆ¥é‡å° settings-panel å…§çš„å…ƒç´ 
          const allZhElements = document.querySelectorAll('.lang-zh');
          const allEnElements = document.querySelectorAll('.lang-en');
          const isZh = lang === 'zh';
          
          allZhElements.forEach(el => {
            el.style.display = isZh ? 'block' : 'none';
          });
          allEnElements.forEach(el => {
            el.style.display = isZh ? 'none' : 'block';
          });
          
          // ç¢ºä¿ settings-panel å’Œ settings-menu å®¹å™¨å¯è¦‹
          const settingsPanel = document.querySelector('.settings-panel');
          const settingsMenu = document.querySelector('.settings-menu');
          if (settingsPanel) {
            settingsPanel.style.display = 'block';
          }
          if (settingsMenu) {
            settingsMenu.style.display = 'flex';
          }
        }, 50);
      };
      return true;
    }
    return false;
  }
  
  // å˜—è©¦ç«‹å³è¨­ç½®
  if (!setupSetLangOverride()) {
    // å¦‚æœå¤±æ•—ï¼Œç­‰å¾… DOM è¼‰å…¥
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(setupSetLangOverride, 100);
      });
    } else {
      setTimeout(setupSetLangOverride, 100);
    }
  }
})();


// é é¢è¼‰å…¥æ™‚æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ä¸¦ç¢ºä¿èªè¨€æ­£ç¢ºé¡¯ç¤º
function initSettingsPage() {
  // é¡¯ç¤º User ID
  initUserId();

  // ç¢ºä¿èªè¨€åˆ‡æ›æ­£ç¢º
  const savedLang = localStorage.getItem('lang') || 'zh';
  if (typeof setLang === 'function') {
    // é‡æ–°æ‡‰ç”¨èªè¨€è¨­å®šï¼Œç¢ºä¿æ‰€æœ‰å…ƒç´ æ­£ç¢ºé¡¯ç¤º
    setLang(savedLang);
  }
  
  setTimeout(function() {
    updateSettingsLangButtons();
  }, 100);
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initSettingsPage);
} else {
  initSettingsPage();
}
</script>

</body>
</html>

